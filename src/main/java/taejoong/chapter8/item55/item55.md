# 옵셔널 반환은 신중히 하라
- 요약
  - 자바 8전에는 메서드가 특정 조건에서 값을 반혼할 수 없을 때 취할 수 있는 선택지가 두 가지 있었다.
    - 예외 던지기 : 예외는 진짜 예외적인 상황에서만 사용해야 하며, 예외를 생성할 때 스택 추적 전체를 캡처하므로 비용도 만만치 않다.
    - null 반환 : null을 반환할 수 있는 메서드를 호출할 때는 별도의 null 처리 코드를 추가해야 한다. null 처리를 무시하고 반환된 null 값을 어딘가에 저장해두면 언젠가 NullPointerException이 발생할 수 있다.
  - 자바 8 이후에는 또 하나의 선택지가 생겼다. Optional<T>다. Optional<T>는 null이 아닌 T 타입 참조를 하나 담거나, 혹은 아무것도 담지 않을 수 있다. 옵셔널은 원소를 최대 1개 가질 수 있는 불변 컬렉션이다.
  - 빈 옵셔널은 Optional.empty()로 만들고, 값이 든 옵셔널은 Optional.of(value)로 생성한다. null 값도 허용하는 옵셔널을 만들려면 Optional.ofNullable(value)을 이용하자
  - 옵셔널을 반환하는 메서드에서는 절대 null을 반환하지 말자
  - 값을 반환하지 못할 가능성이 있고, 호출할 때마다 반환값이 없을 가능성을 염두에 둬야하는 메서드라면 옵셔널을 반환해야 할 상황일 수 있다. 하지만 옵셔널은 약간의 성능 이슈가 있을 수 있다.
  - 옵셔널은 검사 예외와 취지가 비슷하다.
    - 반환값이 없을 수도 있음을 API 사용자에게 명확히 알려준다.
    - 메서드가 옵셔널을 반환한다면 클라이언트는 값을 받지 못했을 때 취할 행동을 선택해야 한다. 기본값을 설정하거나, 원하는 예외를 던지거나, 항상 값이 채워져 있다고 가정하는 방법 등이 있다. orElse(), orElseThrow(), get(), filter(), map(), flatMap(), ifPresent(), isPresent() 등이 있다.
      - 위의 방법에서 약간의 성능 이슈를 보완할 수 있는 방법이 몇가지 있는데, 예외을 던질 때는 실제 예외가 아니라 예외 팩터리를 건네는 것, 기본값을 설정할 때 Supplier<T>를 이용하는 방법 등이다.
  - 컬렉션, 스트림, 배열, 옵셔널 같은 컨테이너 타입은 옵셔널로 감싸면 안된다.
  - 정리하자면 기본 타입 대신 옵셔널로 반환을 해야하는 경우는 1) 결과가 없을 수 있으며, 2) 클라이언트가 이 상황을 특별하게 처리해야 할 경우이다.
  - 기본타입을 위한 OptionalInt, OptionalLong, OptionalDouble이 있으니 박싱된 기본 타입을 담은 옵셔널을 반환하는 일은 없도록 하자.
  - 옵셔널을 반환값 이외의 용도로 쓰는 경우는 매우 드물다.
- 질문