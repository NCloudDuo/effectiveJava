# 스트림 병렬화는 주의해서 적용하라

- 요약
  - 동시성 프로그래밍을 할 때는 안정성과 응답 가능 상태를 유지하여야한다.
  - 스트림 파이프라인 병렬화는 잘못하면 프로그램을 오동작하게 하거나 성능을 급격히 떨어뜨린다. 따라서 신중해야한다.
  - 데이터 소스가 Stream.iterate거나 중간 연산으로 limit을 쓰면 파이프라인 병렬화로는 성능 개선을 기대할 수 없다.
  - 병렬화의 효과가 좋은 케이스
    - 스트림의 소스가 ArrayList, HashMap, HashSet, ConcurrentHashMap의 인스턴스거나 배열, int 범위, long 범위일 때 효과가 좋다. 이 자료구조들은 데이터를 원하는 크기로 정확하고 손쉽게 나눌 수 있어서 일을 다수의 스레드에 분배하기에 좋다는 특징이 있다. 추가적으로 원소들을 순차적으로 실행할 때의 참조 지역성이 뛰어나다는 것이다. 
      - 참조 지역성이 낮으면 스레드는 데이터가 주 메모리에서 캐시 메모리로 전송되어 오기를 기다리며 대부분 시간을 멍하니 보내게 된다.
    - 스트림 파이프라인의 종단 연산의 동작 방식 중에 reduction이 적합하다.
      - mutable reduction인 collect 메서드는 적합하지 않다.
- 질문